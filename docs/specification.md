<!--
【目的・役割】
Summit Gateプロジェクトの詳細なシステム仕様および運用仕様を定義するファイルです。

【作成日】
2025/12/23

【更新履歴】更新履歴:
2025/12/23 09:47 新規作成
2025/12/23 11:20 フロントエンド仕様（山小屋B2Bダッシュボード）の追加
2025/12/23 11:40 送金フローと例外対応（誤送信防止、銀行振込）の追記
2025/12/23 12:15 UX改善策（ソーシャルログイン、アカウント抽象化）の追記
2025/12/23 12:35 法的コンプライアンス設計（非カストディ・公式償還連携）の追記
2025/12/23 13:40 登山客向けQR要件の削除、山小屋向け共同管理（Split）機能の追記
2025/12/23 14:00 運営の法的リスク回避（直接デポジットスキーム）への修正
2025/12/23 14:15 大規模運用（法人枠）に関する上限・運用ルールの追記
2025/12/23 14:35 管理主体の不確実性への対応（自治体・業者両対応）
2025/12/23 14:45 自治体向け「非保有・日本円完結型」フローの追加
2025/12/23 14:55 大口発行（100万円超）に関する制度的解決策の追記
2025/12/23 15:10 静岡県・委託業者・富士宮市の役割分担と多段階送金回避策
2025/12/23 15:25 徴収業者の法的立場（指定公金事務受託者）と実務フローの明文化
2025/12/23 15:40 決済手段別（現金・カード）の精算サイクルとプールの許容
2025/12/23 16:00 累積報酬分配モデル（Accrual Model）への刷新、法的ガバナンスの強化
2025/12/24 10:30 運営による日本円換金・銀行振込代行を「法的リスク回避」のため完全廃止
2025/12/24 14:45 運用自動化に関する追記
2025/12/26 15:55 JPYC直接発行フローの明確化とガスレス（メタトランザクション）の正式採用
2025/12/27 10:10 デモ環境（Frontend-only Demo）の実装仕様とシミュレーションモードの定義追記
2025/12/27 22:45 山小屋向けB2Bデモ画面（/hut）の追加とデモアーキテクチャの更新
-->

# 仕様書 - Summit Gate

## 1. プロジェクト概要

### 1.1 解決する課題（Purpose）
本プロジェクトは、富士山の山小屋運営における以下の**「物理的・労力的負担」を解決すること**を最優先目的とします。

1.  **「小銭の重量」からの解放**:
    *   100円玉等の硬貨は、シーズン中に膨大な量と重量（数百kg〜トン単位）になります。
    *   これをブルドーザーで下山させ、銀行で両替・入金する作業には多大な労力と手数料コストがかかっています。
    *   キャッシュレス化により、この物理輸送コストをゼロにします。
2.  **「トイレ番」の廃止と人件費削減**:
    *   利用数カウントや協力金徴収のためにスタッフがトイレ前に常駐する必要があり、貴重な人手を割いています。
    *   AIカメラによる自動カウントで、無人運用を実現します。
3.  **透明かつ公正な分配**:
    *   従来の不透明な分配ではなく、カメラによる客観的な利用実績データに基づいた配分を行います。

### 1.2 システム概要
**【選定ブロックチェーン: Avalanche C-Chain】**
本プロジェクトは、以下の理由から **Avalanche C-Chain** を唯一の展開先として選定します。
1.  **Subnet（サブネット）構想**: 将来的に「富士山Subnet（行政専用チェーン）」を構築し、KYC済みのノード（自治体・山岳組合）のみで承認を行う「コンプライアンス・チェーン」への移行が可能である唯一の技術基盤であるため。
2.  **即時決済（Instant Finality）**: 1秒未満で取引が確定するため、山小屋での「対面決済（B2B）」においてもストレスのないUXを提供可能。
3.  **EVM互換性**: Solidity資産をそのまま活用でき、技術的な拡張性と安全性が担保される。

### 1.3 データ記録の仕組み（AI & Blockchain）
AIカメラが取得した通過データは、直接オンチェーンに全て記録するわけではありません（ガス代とプライバシーの観点）。
*   **オフチェーン**: 通過ログ（日時、場所、人数）はクラウドまたはセキュアなサーバーに記録・集計されます。
*   **オンチェーン**: 集計された**「分配の根拠となる数値（各山小屋のシェア）」**や、それに基づく**「資金移動（JPYC送金）」**のトランザクションのみをブロックチェーンに記録します。
*   これにより、低コスト運用と、資金分配の透明性（結果の検証可能性）を両立させます。


## 2. 法的コンプライアンス（Legal-by-Design）
本システムにおいて **JPYCを採用する最大の理由** は、運営が資金決済法（資金移動業・カストディ規制）を完全に回避し、持続可能なスキームを構築する唯一無二の手段だからです。

- **JPYC直接発行スキーム（Direct Issuance）**:
  - **フロー**: `委託業者（日本円振込）` → `JPYC社` → `スマートコントラクト（JPYC直接発行）`
  - **詳細**:
    1. 委託業者が徴収した現金をJPYC社の銀行口座へ振り込みます。
    2. JPYC社は、日本円相当額のJPYCを**Summit Gateのスマートコントラクトアドレスへ直接送金（Mint/Transfer）**します。
    3. この時点で資金は「誰のものでもないプール金」としてコントラクトに滞留します。
  - **法的根拠**: 運営（Summit Gate）は、資金の流れにおいて一切の「受取・保管・送金指示」を行いません。資金は委託業者からJPYC社を経由し、プログラムされたコントラクトへ直接デポジットされます。これにより、運営は「資金移動業者」に該当せず、単なる「技術提供者」としての立ち位置を確立します。
  - **透明性**: このフローはブロックチェーン上で誰でも検証可能であり、運営による中抜きや流用が物理的に不可能であることを証明します。

- **非カストディ（Non-Custodial）原則**:
  - 運営は山小屋の秘密鍵を保持せず、資金の移動権限も持ちません。
  - **ガバナンスの分散化**: `owner`権限（パラメータ変更等）は、将来的にマルチシグまたはDAOによる管理に移行し、単一の運営主体による資金操作リスクを技術的に排除します。

  - **銀行振込の法的分離**:
  - 「JPYCから日本円への現金化（銀行振込）」は、第二種資金移動業者であるJPYC株式会社の公式サービス（JPYC EX）を利用します。
  - **制約事項**: JPYC社が取得している「第二種資金移動業」のライセンス規定により、**発行・償還ともに「1日あたり100万円」の上限**が存在します（法人・個人問わず）。
    - 繁忙期に売上が100万円を超える山小屋については、**「数日に分けて償還する」**または**「JPYCのまま業者への支払いに充てる（上限なし）」**運用を推奨します。
  - Summit Gateのダッシュボードは、API連携により「ボタン一つ」で償還手続きを完結させるUIを提供しますが、裏側ではユーザー（山小屋）が直接JPYC社へ償還リクエストを送る形を取ります。

  - **法的安全性**:
    - 資金決済法の壁を**「請求書払い（物品購入扱い）」**でクリアします。
    - 通常の送金（上限100万円/日）とは異なり、請求書払いスキームを利用することで**上限なしの決済**が可能となります。
    - **運用フロー**:
      1. 山小屋はSummit GateダッシュボードでJPYCを受け取る（Withdraw）。
      2. JPYC Apps（公式）等の加盟店で、燃料や物資の請求書をアップロードする。
      3. 支払い方法として「JPYC」を選択し、自身のウォレットから送金する。
      4. JPYC社が代行して業者へ日本円で振込を行う。
    - **残高不足時の対応（Partial Payment）**:
      - 請求額に対しJPYC残高が不足している場合、**「保有全額のみを一部支払い（内金扱い）」**として送金可能です。
      - 残差額については、山小屋が従来通り銀行振込等で業者へ支払うことで、無駄なくJPYCを消費できる設計とします。

- **手数料肩代わり（ガスレス取引）**:
  - **対象**: **日本円への換金（償還）**および、**請求書払いによる送金**の両方。
  - **課題**: 通常、JPYCを送信するにはブロックチェーンの手数料（Gas代/AVAX）が必要ですが、山小屋オーナーにAVAXを用意させるのはUX上の大きなハードルです。
  - **解決策**: JPYC（v2）に実装されている **EIP-3009 (Transfer With Authorization)** または **EIP-2612 (Permit)** を利用します。
  - **仕組み**:
    1. ユーザー（山小屋）は署名のみを行う（Gas代不要）。
    2. 運営（Relayer）が署名を添付してトランザクションを実行し、Gas代を肩代わりする。
    3. これにより、山小屋はAVAXを一切保有することなく、JPYCの送金・償還・支払いが可能となる。
  - **具体的な手順（償還の場合）**:
    1. 山小屋ユーザーは**JPYC EX（公式サイト）で償還予約**を行い、送金先アドレスを確認します。
    2. Summit Gateのダッシュボードでそのアドレスを入力し、「署名（Sign）」のみを行います（Gas不要）。
    3. Summit Gateのバックエンド（Relayer）がその署名を受け取り、Gas代を肩代わりしてブロックチェーンに送信します。
    4. これにより、ユーザーは**日本円やAVAXを一切持たずに、完全無料でJPYCの償還送金**を完了できます。

- **認証・ウォレット管理（UX改善）**:
  - **課題**: 「Web3を意識させたくない」が、JPYC EXの利用には外部ウォレット（EOA）が必要。
  - **解決策**: **Web3Auth / Magic / Privy** 等の Wallet-as-a-Service (WaaS) を導入し、**「Googleログインで裏側にウォレットを自動生成する」** ハイブリッドな構成を採用します。
    1. **ログイン**: 山小屋ユーザーはGoogleアカウント等でSummit Gateにログイン。
    2. **ウォレット生成**: バックグラウンドで非カストディアルなMPC（Multi-Party Computation）ウォレットが生成されます。
       - **紐付け**: 生成されるアドレスはGoogleアカウントに一意に紐づき、固定されます（アカウントを変えない限りアドレスは変わりません）。
    3. **アドレス連携**: ユーザーはSummit Gate上で自分のウォレットアドレスを確認・コピーし、JPYC EXのアカウント情報として登録します。
    4. **メリット**: ユーザーは**シードフレーズの管理やMetamaskのインストールが不要**になり、Web2同様の体験でJPYCの保有・送金が可能になります。
    5. **拡張性**: ダッシュボードに**「秘密鍵のエクスポート機能」**を用意します。将来的にユーザーがMetamask等へ移行したい場合は、秘密鍵を取り出して自身の管理下に移すことが可能です。

  - **UI/UX仕様**:
    - **アドレス自動表示**: ログイン成功時、自動的にウォレットアドレスを取得し、ダッシュボードのヘッダーや設定画面に常時表示します。「コピーボタン」を併設し、JPYC EXへの登録ミスを防ぎます。

  - **アカウント変更・紛失時の運用（重要）**:
    - **Googleアカウント変更時（手動送金のリスク回避策）**:
      - **課題**: ユーザーに長いアドレスを手入力させると誤送金リスクがある。
      - **解決策**: ダッシュボードに**「アカウント引越しモード」**を実装します。
        1. 旧アカウントでログインし、「引越しコード発行」ボタンを押す（一時的なワンタイムコードを生成）。
        2. 新アカウントでログインし、「引越しコード入力」を行う。
        3. システムが裏側で新旧アドレスを安全に紐付け、**旧アカウント側から新アカウントへの送金トランザクションを自動生成**する（ユーザーは署名するだけ）。
    - **Googleアカウント紛失時（ログイン不可）の救済策**:
      - **Web3Auth (MPC) の「多要素復旧」による解決**:
        - **技術**: Web3AuthのMPC（Threshold Cryptography）を使用し、Googleログインができなくても**「他の要素」**で復旧可能な構成にします。
        - **実装**: デフォルトで以下の3つの「鍵（Share）」に分割して管理します（2つ揃えば復旧可能）。
          1. **ソーシャルログインShare**: Googleアカウント（紛失した場合はこれがない）。
          2. **デバイスShare**: ユーザーが普段使っているPCやスマホのブラウザ内に自動保存される鍵。
          3. **バックアップShare**: 登録時に設定する「リカバリーフレーズ」や「セキュリティ質問」。
        - **復旧フロー**:
  - **複数端末での運用・機種変更について**:
    - **Q**: スマホ2台や、PCとスマホ両方で使いたい場合は？
    - **A**: **「デバイス追加（Add Device）」**機能により、新しい端末を「信頼できるデバイス」として登録できます。
      - **手順**:
        1. 既にログイン済みの端末（PC等）で「新しいデバイスを追加」を選択し、QRコードを表示。
        2. 新しい端末（スマホ等）でそのQRコードを読み取る。
        3. 新しい端末にも「デバイスShare」が自動生成・同期され、以降はその端末単体でログイン・署名が可能になります。
    - **機種変更時**:
      - 旧端末がまだ使える場合：上記手順で新端末を追加登録するだけでOK。
      - 旧端末が壊れた/紛失した場合：前述の「多要素復旧（Google + バックアップShare）」を使って新端末でログインし、新しくデバイスShareを生成し直すことで復旧・引き継ぎが可能です。

  - **実証実験開始時のオンボーディング（初期設定フロー）**:
    - **初期PoC版（MVP）のスコープ定義**:
      - **現状**: 「GoogleログインによるMPCウォレット生成」と「アドレス自動収集DB」の完全実装は工数が大きく、PoCフェーズでの実装はリスクが高い。
      - **対応方針**: 初期フェーズでは**「通常のMetamaskログイン」**を採用し、プレゼン資料にて「将来的にはMPC導入によりWeb3を意識させないUXを実現する」とロードマップとして提示する。（詳細: [ロードマップ](roadmap.md)）
    - **将来実装（本番運用）**:
      - 前述の「Googleログイン + 自動DB登録」フローを実装し、UXを最適化します。
    
  - **デモ環境の実装仕様**:
    - **目的**: 実際のブロックチェーン（ローカルノードまたはテストネット）と接続し、一連の資金フローを可視化する。
    - **山小屋ログイン**:
      - デモでは、実際の **Metamask** を使用して山小屋オーナーとしての操作（署名・引き出し）を実演する。
      - **Simulation Mode** ではなく、実トランザクションを発行することで、システムの透明性と確実性を証明する。





- **送金機能の制限（セキュリティ・誤送金防止）**:
  - **方針**: JPYC EX（償還）以外の送金先についても対応しますが、**「任意のアドレス手入力」は原則禁止（または非推奨）**とします。
  - **理由**:
    1. **誤送金（GOX）防止**: 慣れていないユーザーがアドレスを手入力すると、入力ミスやチェーン間違いにより資金を永久に失うリスクが高いため。
    2. **Gas代負担の適正化**: 運営がGas代を肩代わりするため、無関係な個人アドレスへの送金などで悪用される（フリーライドされる）のを防ぐため。
  - **実装仕様**:
    - **ホワイトリスト方式**: 「よく使う送金先（取引業者など）」は、事前に運営またはユーザー自身が登録し、選択式で送金する。
    - **山小屋間送金**: システム内のユーザー（他の山小屋）へは、アドレス入力不要で**「山小屋名を選択するだけ」**で送金可能にする。


## 3. システム構成

### 3.1 AIカメラ（Edge AI Counter）
- **ハードウェア**: **Seeed Studio reCamera 2002** または同等のRISC-V搭載エッジAIカメラ。
  - **選定理由**: 1 TOPSのAI処理能力（YOLOv8/v11動作可能）を持ちながら、単体で動作するLinuxカメラであり、導入コストを大幅に抑制できるため。
- **設置形態**: 
  - **推奨**: トイレ入口の上部（天井または鴨居）に下向き（Top-down）設置。
  - **代替**: 入口が見える壁面等への斜め設置（Diagonal）。
- **機能**:
  - **エッジ処理**: 映像はデバイス内でリアルタイムに解析され、座標と人数のみを抽出。**映像そのものは保存・送信せず即時破棄**することでプライバシーを完全に保護する。
  - **人数カウント**: AIによる追跡（Tracking）を行うことで、**「入室方向（In）」のみをカウント**し、退室時の重複カウントを排除する。
  - **暗所対応**: デバイス搭載の補助ライト（白色LED）または外付け人感センサーライトを併用し、夜間でも安定した検知を行う。
#### 通信環境と拡張（Wi-Fi中継）
- **通信手段の優先順位（コスト・安定性順）**:
  1. **Starlink Wi-Fi (推奨)**: 
     - 多くの山小屋で導入が進んでいるStarlinkのルーターに接続させてもらう。
     - 一般的な暗号化方式(WPA2-PSK)のため、**安価な中継機(¥3,000)でエリア拡張が可能**。
     - **アクション**: 山小屋管理者への接続許可交渉。
  2. **Wi2有料契約 (Starlinkなしの場合)**:
     - KDDI系公衆Wi-Fiの高セキュリティSSID (`Wi2eap` 等) を利用する。
     - **契約**: プロジェクト側で「ギガぞう」や「Wi2 300」等の有料アカウント（月額約362円〜）を契約し、ID/PWをカメラに設定することで**Web認証を回避**できる。
     - **注意**: 一般的な安価な中継機はこの方式(WPA2-Enterprise)に対応していないため、カメラを電波の良い場所に設置するか、上位機種の中継機が必要となる。
  3. **LTEドングル (最終手段)**:
     - 上記どちらも不可の場合、USBドングルで携帯回線を使用（初期¥12,000 + 月額¥500〜）。

### 3.2 運用・保守仕様（越冬・電源）
- **電源供給**:
  - 山小屋の既存電源（コンセント/USB）から供給。
  - **モバイルバッテリー廃止**: 火災リスクや管理の手間を考慮し、バッテリーは搭載しない。
  - **停電対策**: 停電時はデバイスも停止するが、**通電再開時に自動でOSが起動し、アプリケーションが復帰する設定**（Auto Power-on）を施すことで、人手を介さずに復旧させる。
- **越冬運用（Winterization）**:
  - **基本方針**: 山小屋内の通信機器と同様、**設置したまま越冬することも可能**である。
    - reCamera等の産業用・組込用機器は、一般的な民生品より環境耐性が高い。小屋内であれば極端な風雪には晒されないため、生存率は高い。
  - **推奨オプション（持ち帰り）**: 
    - ソフトウェアの大規模アップデートや、万が一の故障リスク（結露・浸水）をゼロにしたい場合は、容易に取り外して持ち帰ることも可能な設計とする。

### 3.3 AIカメラ導入によるメリット
- **圧倒的なコスト削減**: 
  - 従来の専用ゲート機器やハイスペックAI機材に対し、**1台1万円以下**の汎用機材コストで導入可能。
  - **ランニングコストの最小化**:
    - 通信費（既存Wi-Fi利用）とわずかな電気代のみで運用可能。
    - 従来の人手によるカウントや監視にかかる人件費を削減。
- **完全ウォークスルー**: 
  - 登山者は立ち止まることなく、スムーズに通過可能。
  - 物理的なゲートや認証機器の設置が不要なため、景観を損なわない。
- **環境配慮**: 
  - 物理的なチケットや消耗品を出さないエコな運用。

### 3.4 ソフトウェア構成 (Layered Architecture)

**A. オンチェーン層 (Avalanche C-Chain)**
*   **SummitGate.sol**: 資金プールと分配ロジックを管理するメインコントラクト。
*   **JPYC v2**: 決済通貨（ERC20）。

**B. オフチェーン層 (Cloud & Batch System)**
*   **Data Aggregator**: 各山小屋のAIカメラから送信されるJSONデータ（日時、カウント数）を受信・DB格納。
*   **Batch Worker (Scheduler)**: 
    *   **役割**: 「分配案の作成」と「異常値の補正」を行うバックエンド処理。
    *   **Human-in-the-loop**: 初期フェーズでは、システムが作成した分配案（トランザクションデータ）を運営者が確認し、署名することで実行される。
    *   **欠測補完**: 停電等で特定の山小屋のデータが欠落した場合、過去の傾向や同日の他山小屋のデータから数値を推計・補完する。

**C. クライアント層 (Frontend)**
*   **Admin Dashboard**: 運営者が全山小屋の稼働状況を監視し、システムの提案を承認する管理画面。
*   **Hut Dashboard**: 山小屋オーナーが自社の分配予定額や着金履歴を確認する画面。

### 3.5 ソフトウェアロジック（Edge AI Logic）
**プログラミング難易度: 低〜中**
Python等の高水準言語を使用し、既存のライブラリ（YOLO, OpenCV）を組み合わせるだけで実装可能です。複雑なAIモデルの学習（Training）は不要で、学習済みモデル（Pre-trained Model）を利用します。

```python
# カウントロジックのイメージ（Python風擬似コード）
def main_loop():
    # 1. モデル読み込み（「人」を認識できる学習済みYOLOモデル）
    model = load_model("yolov8n.pt")
    
    # 2. 追跡（Tracking）設定
    # IDを振ることで、同じ人がフレーム内を移動しても「1人」として認識し続ける
    tracker = ObjectTracker()
    
    while True:
        image = camera.capture()
        
        # 3. 人を検出
        persons = model.detect(image, class="person")
        
        for person in persons:
            # 過去のフレームと照合してIDを付与
            track_id = tracker.update(person)
            
            # 4. ライン通過判定（入室方向のみ）
            # 画面中央のラインを「上から下へ」またいだ瞬間だけカウント
            if tracker.did_cross_line(track_id, direction="IN"):
                count += 1
                save_log(count)
```

### 3.6 権限管理 (Access Control)
システム運用におけるリスク分散と役割分担のため、OpenZeppelin `AccessControl` を採用し、以下の権限を定義します。

| ロール名 | 識別子 | 権限内容 | 想定保有者（初期） | 将来像（マルチシグ移行後） |
| :--- | :--- | :--- | :--- | :--- |
| **DEFAULT_ADMIN_ROLE** | `0x00...` | 全ロールの管理（付与・剥奪） | 開発者/運営 | 運営DAO / マルチシグ |
| **OPERATOR_ROLE** | `keccak256("OPERATOR_ROLE")` | 分配額の計算結果反映（`allocate`, `batchAllocate`） | 運営バックエンド | 自動化Bot / 運営 |
| **CONFIG_ROLE** | `keccak256("CONFIG_ROLE")` | 手数料設定の変更（`setFeeConfig`） | 運営管理者 | 運営DAO（投票で決定） |

- **設計意図**:
  - **OPERATOR_ROLE**: 日々の分配業務を行うシステム（または担当者）に付与。万が一秘密鍵が流出しても、手数料設定や管理者権限の変更はできないため、被害を限定できる。
  - **CONFIG_ROLE**: 手数料率などの重要パラメータ変更権限。頻繁には使用しないため、より厳重な管理（コールドウォレット等）が可能。

### 3.7 データフローとシミュレーション（PoC対応）
本番環境ではIoTデバイスからのリアルタイム通信を行いますが、PoC（概念実証）ではJSONダミーデータを用いたシミュレーションでフローを実証します。

- **本番運用フロー（Store-and-Forward）**:
  1. **IoT Edge (Store)**: AIカメラが通過者を検知し、デバイス内のメモリに一時保存（バッファリング）。
  2. **Transmission (Forward)**: 一定時間ごと（例：1時間毎）または通信確立時に、蓄積されたログをまとめてサーバーへ送信（バッチ送信）。
     - **メリット**: 通信回数を減らしてコスト（LTE-M/NB-IoT通信費）を削減し、一時的な圏外やWi-Fi断にも耐える設計とします。
  3. **Backend**: 受信データをDB（Supabase）に保存 -> ノイズ除去・集計。
  4. **Batch Worker**: 日次で集計結果に基づき、コントラクトの `batchAllocate` を実行。

- **PoC（概念実証）およびデモ環境の提供**:
  本番に近い環境で、システムの核となる「分配ロジック」と「資金フロー」を体験できる2つのモードを提供します。

  1. **管理画面デモモード**:
     - `admin/page.tsx` に実装された `DEMO_MODE` フラグにより、一部のバックエンド処理（AIデータ取得）をモック化。
     - **機能**: 資金プールへの仮想入金、利用実績データの編集（JSON読み込み）、分配計算、承認実行。
     - **特徴**: 実際のスマートコントラクト（Local Hardhat Node）と通信し、オンチェーンでの分配実行を検証可能。

  2. **山小屋B2Bデモ画面 (/hut)**:
     - **目的**: 山小屋オーナー視点での「残高確認」「資金引き出し」体験を提供。
     - **機能**: Metamask等のウォレットで接続し、リアルタイムでの残高反映、引き出し操作を行う。
     - **連携**: `useDemoData` フックを通じて管理画面とデータを同期（デモ用）。管理画面で承認すると即座に山小屋画面に残高が反映される。

  3. **オンチェーン・シミュレーション**:
     - ローカルブロックチェーン（Hardhat）を起動し、実際のスマートコントラクトと対話するモード。
     - `data/dummy_rfid_logs.json` のダミーデータを用い、スクリプトまたは管理画面から実際のトランザクションを発行して検証を行う。

この構成により、アンテナが無くても「データに基づいた公正な分配」と「B2B資金移動の透明性」というシステムの核を効果的にプレゼン可能です。

### 3.8 機材コスト構成 (Bill of Materials)
reCameraを採用した場合の、富士宮ルート全体（25台想定）の導入コスト試算です。

| 品目 | 想定製品例 | 単価 | 数量 | 小計 | 備考 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **Edge AI Camera** | Seeed reCamera 2002 (8GB) | ¥11,000 | 1 | ¥11,000 | 本体 (eMMC 8GB内蔵・ケーブル1.5m付属) |
| **USB-ACアダプタ** | Anker PowerPort mini 等 | ¥1,000 | 1 | ¥1,000 | 5V/2A以上 |
| **固定具** | SMALLRIG カメラマウント 等 | ¥2,000 | 1 | ¥2,000 | 1/4インチネジ対応 |
| **電源延長コード** | エレコム 電源タップ 3m〜5m | ¥1,000 | 1 | ¥1,000 | 天井付近までの配線用 |
| **(Option) Wi-Fi中継機** | Starlink用: TP-Link RE330<br>Wi2用: GL.iNet GL-SFT1200 | ¥5,500 | 1 | ¥5,500 | 環境により選択（最大価格で計上） |
| **(Option) 暗所用ライト** | アイリスオーヤマ 乾電池式センサーライト | ¥1,500 | 1 | ¥1,500 | 照明がない暗所への設置時のみ必要 |
| **合計 (1台あたり/Full Option)** | | | | **¥22,000** | **従来の高価なゲート設備に対し大幅削減** |

**【通信環境に関する補足】**
- **Wi-Fi利用（標準）**: 
  - **Starlink環境（推奨）**: 山小屋のStarlinkルーター（WPA2-PSK）に接続。安価な中継機(TP-Link RE330等 ¥3,000)で延長可能。
  - **公衆Wi-Fi環境**: Starlinkがない場合、KDDI系公衆Wi-Fiの「Wi2eap」を利用（要・有料契約）。
    - **中継が必要な場合**: 「WPA2-Enterprise」に対応した**GL.iNet GL-SFT1200 (Opal)** 等のトラベルルーター（約5,500円）を使用します。
- **Wi-Fi不可時のオプション（LTE対応）**:
  - Wi-Fiが届かない場所では、reCameraのUSBポートに「LTE USBドングル（例: PIX-MT110等）」を接続してモバイル回線化します。
  - **追加コスト**: 
    - ドングル本体: 約12,000円
    - SIM通信費: 月額500円〜（IoT用低速SIM）
    - ※今回は「山小屋（Wi-Fiあり）のトイレ」設置前提のため、このコストは計上していません。

**【富士宮ルート導入試算】**
- **想定台数**: 25台
  - 富士宮ルートの山小屋数に加え、男女別トイレや予備機を含めた概算。
- **初期導入費**: ¥20,500 × 25台 = **¥512,500**

**【コスト比較（対有人管理）】**
- **比較条件**: 富士宮ルートの年間登山者数 約6万人と仮定。
- **従来方式（有人管理）**:
  - 各山小屋でのトイレ番・集計スタッフの人件費が発生。
  - 現金輸送・両替コストが発生。
- **AIカメラ方式**:
  - 初期費用 **約51万円**（初年度のみ）
  - ランニングコストは電気代と少額のWi-Fi契約費のみ。
  - **人件費および現金管理コストの大幅な削減**が見込める。

## 4. 経済設計（トークンエコノミクス）

### 4.1 料金体系の内訳（インセンティブ設計）
山小屋・委託業者・運営の三者が納得し、システムが持続する収益構造を定義します。

- **一括徴収額**: 6,000円
- **環境保全金（2,000円）の分配内訳**:
  - **山小屋分配分**: **1,800円 (90.0%)**
    - **根拠**: 富士登山における平均トイレ利用回数（登り3〜4回、下り1〜2回、計6回）× チップ単価300円 ＝ 1,800円。
  - **委託業者・代行手数料**: **100円 (5.0%)**
    - **内訳**: 現地での案内・説明スタッフ人件費 ＋ 事前決済（クレカ/アプリ）手数料。
    - **運用**: 委託業者からJPYC社へ振り込む段階で既に控除されており、コントラクトへの入金は「残額（1,900円/人）」がベースとなります。
  - **Summit Gateシステム利用料**: **100円 (5.0%)**
    - **用途**: **AIカメラ保守・交換積立**、クラウド維持費、死活監視システムの運用。
    - **徴収方法**: コントラクトでの分配実行時に、山小屋配分額に対して**設定された手数料比率（初期設定 18:1）**で自動徴収（On-chain Auto Deduction）します。
      - 計算式: `運営手数料 = 山小屋配分額 × (分子 / 分母)`
      - 初期設定: 分子=1, 分母=18 (1800:100 の比率を実現)
      - 例: 1,900 JPYCが着金した場合、比率に基づき山小屋へ1,800 JPYC、運営へ100 JPYCが分配されます。
    - **セキュリティ対策（Rug Pull防止）**:
       - **ハードキャップ（上限設定）**: スマートコントラクトのコード内に**「手数料率は最大10%（山小屋受取額の1/9）」**という変更不可能な制約を埋め込んでいます。
       - **実装詳細**: 端数処理の問題を回避するため、単純なパーセンテージではなく「分子/分母（Numerator/Denominator）」形式で管理しており、`9 * Numerator <= Denominator`（山小屋受取額の1/9以下＝総額の1/10以下）という条件式により、数学的に10%以下に制限されます。
       - **現在の設定**: 初期値は `1/18`（全体に対して約5.3%）に設定されており、十分な余裕を持たせています。
      - **リスク回避**: これにより、将来的に運営が悪意を持ったり、鍵が流出したりした場合でも、過大な手数料を設定して資金を持ち逃げすることは技術的に不可能です。
      - **透明性**: 現在の手数料比率（分子・分母）はブロックチェーン上で公開され、誰でも検証可能です。

## 5. 展開計画
2. **限定展開**: 管理が容易な富士宮ルートに限定して開始。
3. **地理的制約と展開範囲（富士山特化）**:
    *   本システムは、「一本道の登山道」かつ「電源・通信が確保可能なカメラ設置ポイント」が存在する富士山（特に富士宮ルート）の特殊な地理的条件に依存します。
    *   複数の登山口や分岐が多数存在する他の山域（北アルプス等）では、カメラによる全数把握が物理的に不可能であるため、本システムの他山域への水平展開（SaaS化）は想定しません。あくまで「富士山専用のインフラ」として完成を目指します。

## 6. 成功指標

本プロジェクトは、単なる技術実証にとどまらず、実際の富士山における運用課題を解決し、持続可能なモデルを確立することを目指します。

### 6.1 定量的指標（KPI）
1.  **物理的コスト削減**:
    *   小銭輸送量: **100%削減**（数百kg/年 → 0kg）
    *   銀行手数料・輸送人件費: **100%削減**
2.  **運用効率化**:
    *   トイレ番（徴収係）の常駐時間: **0時間**（無人化達成）
    *   利用状況のデジタル可視化: アナログな集計作業からの解放
3.  **分配の公正性**:
    *   データに基づく分配率: **100%**（恣意性を完全排除）
    *   **資金管理のDX化**: 現金の物理管理（数え上げ・保管・輸送）から、**即時デジタル残高確認・引き出し**への移行（小銭管理コストの削減）

### 6.2 定性的指標
1.  **ユーザー体験（UX）の向上**:
    *   登山者: 利用時の待ち時間短縮（スムーズな通行）。
    *   山小屋: 現金管理リスク（盗難・紛失）からの解放。
2.  **社会的インパクト**:
    *   透明性の高い寄付モデルの確立による、協力金支払率の向上。
    *   「ブロックチェーン×IoT」による地域課題解決（地方創生）のロールモデル確立。

### 6.3 次フェーズへの移行基準
*   PoCにおけるデータ取得率（検知精度）が95%以上であること。
*   山小屋オーナーおよび行政担当者からのUXに対する肯定的フィードバックが得られること。
